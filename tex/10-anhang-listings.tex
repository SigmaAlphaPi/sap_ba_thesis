\section{Anhang}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Code-Listings}

\begin{lstlisting}[style=asl, 
                   keywords={+!cruise,+!accelerate,+!linger,+!decelerate,+!vehicle/collision}, 
                   keywords={[2]}, 
                   keywords={[3]}, 
                   caption={Agentenscript: NaSch-Modell, einspurig},
                   label={lst:nasch}]      
/*
 *  ASL file        NaSch model traffic, single lane
 */

!cruise.

// --- start all other plans ---
+!cruise <-
    !accelerate;
    !decelerate;
    !linger;
    !cruise
.

// --- acceleration ---
+!accelerate
    // --- accelerate only, if no traffic ahead ---
    // --- otherwise you have to brake against the acceleration ---
    // --- resulting in too long braking distances ---
    : 
        CurrentSpeed < AllowedSpeed
        && ~>>( view/vehicle( _, data( _, static( lane( FwdLane ), cell( FwdCell ), speed( FwdSpeed ), distance( FwdDist ), direction( FwdDir ) ) ) ),
                bool/equal( generic/type/tostring( FwdDir ), "forward[]" )
                && FwdDist < CurrentSpeed
                && FwdSpeed < CurrentSpeed
            )
    <-
        vehicle/accelerate(0.5);
        !accelerate
.

// --- lingering ---
+!linger <-
    L = math/statistic/randomsimple;
    L < 0.1;
    vehicle/decelerate(0.3)
.

// --- deceleration ---
+!decelerate 
/*
    // --- decelerate if max. allowed speed is reached ---
    // --- if commented out vehicle will cruise slightly over speed limit ---
    : CurrentSpeed > AllowedSpeed <-
        vehicle/decelerate(0.05);
        !decelerate
*/
    // --- decelerate if traffic is ahead ---
    // --- and own speed is higher than distance ---
    : >>( view/vehicle( _, data( _, static( lane( FwdLane ), cell( FwdCell ), speed( FwdSpeed ), distance( FwdDist ), direction( FwdDir ) ) ) ), 
            bool/equal( generic/type/tostring( FwdDir ), "forward[]" ) 
            && FwdDist < CurrentSpeed
        ) <-
        vehicle/decelerate(1);
        !decelerate
.

// --- collision ---
+!vehicle/collision <-
/*
    // --- brake as hard as possible ---
    vehicle/decelerate( 1 );
*/
    // --- stop immediately ---
    vehicle/stop;
.\end{lstlisting}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{lstlisting}[style=asl, 
                   keywords={+!cruise,+!accelerate,+!linger,+!decelerate,+!vehicle/collision}, 
                   keywords={[2]}, 
                   keywords={[3]}, 
                   caption={Agentenscript: NaSch-Modell, mehrspurig},
                   label={lst:multi-lane}]      
/*
 *  ASL file        NaSch model traffic, multi lane
 */

!cruise.

// --- start all other plans ---
+!cruise <-
    !accelerate;
    !decelerate;
    !pullout;
    !pullin;
    !linger;
    !cruise
.

// --- NOCH NICHT VOLLSTAENDIG ---
\end{lstlisting}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{lstlisting}[style=asl, 
                   keywords={}, 
                   keywords={[2]}, 
                   keywords={[3]}, 
                   caption={Agentenscript: Auszug Bedingungen pullout-Plan},
                   label={lst:pullout-cond}]      
/*
 *  ASL file        pullout conditions (separate for testing)
 */

+!pullouttest <-
    // --- TEST SETUP FOR THE CONDITIONS ---
    // --- each condition has an output line for control purposes ---

    Cond1 = CurrentLane < Lanes; 
    generic/print("vehicle is not on leftmost lane:", Cond1); 

    Cond2 = >>( view/vehicle( _, data( _, static( lane( FwdLane ), cell( FwdCell ), speed( FwdSpeed ), distance( FwdDist ), direction( FwdDir ) ) ) ),
                bool/equal( generic/type/tostring( FwdDir ), "forward[]" ) 
                && math/floor( FwdLane ) == CurrentLane
                && FwdDist < 175 
                ); 
    generic/print("traffic ahead in own lane:", Cond2); 

    Cond3 = ~>>( view/vehicle( _, data( _, static( lane( FwdLane2 ), cell( FwdCell2 ), speed( FwdSpeed2 ), distance( FwdDist2 ), direction( FwdDir2 ) ) ) ),
                bool/equal( generic/type/tostring( FwdDir2 ), "forward[]" ) 
                && math/floor( FwdLane2 ) == CurrentLane+1
                && FwdDist2 < FwdDist 
                ); 
    generic/print("lane to pull into is not worse:", Cond3); 

    Cond4 = ~>>( view/vehicle( _, data( _, static( lane( LeftLane ), cell( LeftCell ), speed( LeftSpeed ), distance( LeftDist ), direction( LeftDir ) ) ) ),
                bool/equal( generic/type/tostring( LeftDir ), "left[]" ) 
                && math/floor( LeftLane ) == CurrentLane+1
                );
    generic/print("no traffic directly to the left on lane to pull into:", Cond4);

    Cond5 = ~>>( view/vehicle( _, data( _, static( lane( BwdLane ), cell( BwdCell ), speed( BwdSpeed ), distance( BwdDist ), direction( BwdDir ) ) ) ),
                bool/equal( generic/type/tostring( BwdDir ), "backward[]" ) 
                && math/floor( BwdLane ) == CurrentLane+1
                && BwdDist < 100
                && BwdSpeed > CurrentSpeed 
                );
    generic/print("not hindering traffic behind in lane to pull into", Cond5);

    Combined = Cond1 && Cond2 && Cond3 && Cond4 && Cond5;
    generic/print("all combined", Combined)
.\end{lstlisting}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{lstlisting}[style=asl, 
                   keywords={}, 
                   keywords={[2]}, 
                   keywords={[3]}, 
                   caption={Agentenscript: Auszug Bedingungen pullin-Plan},
                   label={lst:pullin-cond}]      
/*
 *  ASL file        pullin conditions (separate for testing)
 */

+!pullintest <-
    // --- TEST SETUP FOR THE CONDITIONS ---
    // --- each condition has an output line for control purposes ---

    Cond1 = CurrentLane > 1;
    generic/print("vehicle is not on rightmost lane:", Cond1);

    Cond2 = ~>>( view/vehicle( _, data( _, static( lane( FwdLane ), cell( FwdCell ), speed( FwdSpeed ), distance( FwdDist ), direction( FwdDir ) ) ) ),
                bool/equal( generic/type/tostring( FwdDir ), "forward[]" ) 
                && math/floor( FwdLane ) == CurrentLane-1
                );
    generic/print("no other vehicle in forward view on lane to pull into", Cond2);

    Cond3 = ~>>( view/vehicle( _, data( _, static( lane( RightLane ), cell( RightCell ), speed( RightSpeed ), distance( RightDist ), direction( RightDir ) ) ) ),
                bool/equal( generic/type/tostring( RightDir ), "right[]" ) 
                && math/floor( RightLane ) == CurrentLane-1
                );
    generic/print("no other vehicle directly to the right on lane to pull into", Cond3);

    Cond4 = ~>>( view/vehicle( _, data( _, static( lane( BwdLane ), cell( BwdCell ), speed( BwdSpeed ), distance( BwdDist ), direction( BwdDir ) ) ) ),
                bool/equal( generic/type/tostring( BwdDir ), "backward[]" ) 
                && math/floor( BwdLane ) == CurrentLane-1
                && BwdDist < 125
//                && BwdSpeed > CurrentSpeed 
                );
    generic/print("not hindering traffic behind on lane to pull into", Cond4);

    Combined = Cond1 && Cond2 && Cond3 && Cond4;
    generic/print("all combined", Combined)
.\end{lstlisting}
